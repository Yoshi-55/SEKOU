<%= form_with(model: job, class: "space-y-6") do |f| %>
  <% if job.errors.any? %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      <p class="font-bold mb-2"><%= pluralize(job.errors.count, "個") %>のエラーがあります:</p>
      <ul class="list-disc list-inside">
        <% job.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- 基本情報 -->
  <div class="border-b pb-6">
    <h2 class="text-xl font-bold mb-4">基本情報</h2>

    <div class="space-y-4">
      <div>
        <%= f.label :group_id, "公開グループ（必須）", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :group_id,
          options_from_collection_for_select(current_user.groups, :id, :name, f.object.group_id),
          { prompt: "グループを選択してください" },
          class: "w-full border border-gray-300 rounded px-4 py-2" %>
        <p class="text-sm text-gray-500 mt-1">※案件は選択したグループのメンバーのみに公開されます</p>
        <% if current_user.groups.empty? %>
          <p class="text-sm text-red-600 mt-1">※グループに参加する必要があります</p>
        <% end %>
      </div>

      <div>
        <%= f.label :title, "案件タイトル", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :title, class: "w-full border border-gray-300 rounded px-4 py-2", placeholder: "例: カーラッピング施工スタッフ募集" %>
      </div>

      <div>
        <%= f.label :description, "案件詳細", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_area :description, rows: 8, class: "w-full border border-gray-300 rounded px-4 py-2", placeholder: "案件の詳細を記入してください..." %>
        <p class="text-sm text-gray-500 mt-1">※作業内容、必要な技術、注意事項などを詳しく記入してください</p>
      </div>

      <div class="grid grid-cols-1 gap-4">
        <div>
          <%= f.label :job_type, "案件種別", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :job_type,
            [
              ["カーラッピング施工", "car_wrapping"],
              ["フリート施工", "fleet"],
              ["PPF施工", "ppf"],
              ["その他", "other"]
            ],
            { include_blank: "選択してください" },
            class: "w-full border border-gray-300 rounded px-4 py-2" %>
        </div>

        <div>
          <%= f.label :location, "地域", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :location,
            [
              ["東京都", "東京都"],
              ["神奈川県", "神奈川県"],
              ["埼玉県", "埼玉県"],
              ["千葉県", "千葉県"],
              ["大阪府", "大阪府"],
              ["愛知県", "愛知県"],
              ["福岡県", "福岡県"],
              ["その他", "その他"]
            ],
            { include_blank: "選択してください" },
            class: "w-full border border-gray-300 rounded px-4 py-2" %>
        </div>
      </div>

      <div>
        <%= f.label :address, "詳細住所（任意）", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :address, class: "w-full border border-gray-300 rounded px-4 py-2", placeholder: "例: 渋谷区神南1-1-1" %>
      </div>
    </div>
  </div>

  <!-- 条件 -->
  <div class="border-b pb-6">
    <h2 class="text-xl font-bold mb-4">条件</h2>

    <div class="grid grid-cols-1 gap-4">
      <div>
        <%= f.label :budget, "日当（円）", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.number_field :budget, class: "w-full border border-gray-300 rounded px-4 py-2", placeholder: "25000", min: 5000, step: 5000 %>
        <p class="text-sm text-gray-500 mt-1">※5000円単位で入力してください</p>
      </div>

      <div>
        <%= f.label :scheduled_date, "作業予定日", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :scheduled_date, class: "w-full border border-gray-300 rounded px-4 py-2" %>
      </div>

      <div>
        <%= f.label :required_people, "必要人数", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.number_field :required_people, class: "w-full border border-gray-300 rounded px-4 py-2", value: job.required_people || 1, min: 1 %>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex gap-4">
    <%= button_tag "案件を掲載する", type: "submit",
          disabled: current_user.groups.empty?,
          class: "flex-1 px-4 py-2 rounded-lg font-medium text-sm #{ current_user.groups.empty? ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 text-white' }" %>
    <%= link_to "キャンセル", jobs_path, class: "inline-flex items-center px-4 py-2 rounded-lg font-medium text-sm text-gray-700 hover:bg-gray-100" %>
  </div>
<% end %>
