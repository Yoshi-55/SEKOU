<% if !user_signed_in? || current_user.groups.empty? %>
  <!-- グループ未所属の場合のメッセージ -->
  <div class="bg-white rounded-lg shadow p-12 text-center">
    <% if !user_signed_in? %>
      <h2 class="text-2xl font-bold mb-4">案件を閲覧するにはログインが必要です</h2>
      <p class="text-gray-600 mb-6">このプラットフォームはグループメンバー限定で案件を共有するサービスです。</p>
      <%= link_to "ログイン", new_user_session_path, class: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg inline-block font-medium mr-2" %>
      <%= link_to "新規登録", new_user_registration_path, class: "bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg inline-block font-medium" %>
    <% else %>
      <h2 class="text-2xl font-bold mb-4">グループに参加してください</h2>
      <p class="text-gray-600 mb-6">案件を閲覧するには、グループを作成するか、既存のグループに参加する必要があります。</p>
      <%= link_to "グループを作成する", new_group_path, class: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg inline-block font-medium" %>
    <% end %>
  </div>
<% else %>
  <div class="mb-4 md:mb-6">
    <h1 class="text-2xl md:text-3xl font-bold mb-2">案件一覧</h1>
    <p class="text-gray-600">カーラッピング・フリート施工案件を探す</p>
  </div>

  <!-- Filter and Sort Section -->
  <div class="bg-white rounded-lg shadow p-4 md:p-6 mb-4 md:mb-6">
    <%= form_with url: jobs_path, method: :get, class: "space-y-4" do |f| %>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
        <!-- Job Type Filter -->
        <div>
          <%= f.label :job_type, "案件種別", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :job_type,
            options_for_select([
              ["すべて", ""],
              ["カーラッピング", "car_wrapping"],
              ["フリート施工", "fleet"],
              ["PPF施工", "ppf"],
              ["その他", "other"]
            ], params[:job_type]),
            {},
            class: "w-full border border-gray-300 rounded px-3 py-2" %>
        </div>

        <!-- Location Filter -->
        <div>
          <%= f.label :location, "地域", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :location,
            options_for_select([
              ["すべて", ""],
              ["東京都", "東京都"],
              ["神奈川県", "神奈川県"],
              ["埼玉県", "埼玉県"],
              ["千葉県", "千葉県"],
              ["大阪府", "大阪府"],
              ["愛知県", "愛知県"],
              ["福岡県", "福岡県"],
              ["その他", "その他"]
            ], params[:location]),
            {},
            class: "w-full border border-gray-300 rounded px-3 py-2" %>
        </div>

        <!-- Min Budget Filter -->
        <div>
          <%= f.label :min_budget, "最低予算", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :min_budget,
            value: params[:min_budget],
            placeholder: "例: 50000",
            class: "w-full border border-gray-300 rounded px-3 py-2" %>
        </div>

        <!-- Max Budget Filter -->
        <div>
          <%= f.label :max_budget, "最高予算", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :max_budget,
            value: params[:max_budget],
            placeholder: "例: 200000",
            class: "w-full border border-gray-300 rounded px-3 py-2" %>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
        <!-- Sort -->
        <div class="flex-1">
          <%= f.label :sort, "並び替え", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :sort,
            options_for_select([
              ["新着順", ""],
              ["予算が高い順", "budget_desc"],
              ["予算が低い順", "budget_asc"],
              ["作業日が近い順", "date"]
            ], params[:sort]),
            {},
            class: "w-full border border-gray-300 rounded px-3 py-2" %>
        </div>

        <!-- Submit Buttons -->
        <div class="flex items-end gap-2">
          <%= f.submit "検索", class: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg cursor-pointer font-bold text-base" %>
          <%= link_to "クリア", jobs_path, class: "bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-3 rounded-lg font-bold text-base" %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Job Listings -->
  <% if @jobs.present? %>
    <div class="space-y-4 mb-6">
      <% @jobs.each do |job| %>
        <%= link_to job_path(job), class: "block" do %>
          <div class="bg-white rounded-lg shadow hover:shadow-lg transition p-4 md:p-6">
            <div class="flex-1">
              <!-- Title -->
              <h3 class="font-bold text-lg md:text-xl text-gray-900 mb-2"><%= job.title %></h3>

              <!-- Description -->
              <p class="text-gray-600 mb-3 text-sm md:text-base"><%= truncate(job.description, length: 100) %></p>

              <!-- Job Details -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 text-sm">
                <div class="flex items-center gap-1 text-gray-700">
                  <span class="font-medium">種別:</span>
                  <span class="truncate"><%= job.job_type %></span>
                </div>
                <div class="flex items-center gap-1 text-gray-700">
                  <span>📍</span>
                  <span class="truncate"><%= job.location %></span>
                </div>
                <div class="flex items-center gap-1 text-gray-700">
                  <span>💰</span>
                  <span class="font-bold text-blue-600"><%= number_to_currency(job.budget, unit: "¥", precision: 0) %></span>
                </div>
                <div class="flex items-center gap-1 text-gray-700">
                  <span>📅</span>
                  <span><%= l(job.scheduled_date, format: :short) %></span>
                </div>
              </div>

              <!-- Additional Info -->
              <div class="mt-2 text-xs md:text-sm text-gray-500">
                <span>必要人数: <%= job.required_people %>名</span>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- Pagination -->
    <div class="flex justify-center">
      <%= paginate @jobs %>
    </div>
  <% else %>
    <div class="bg-white rounded-lg shadow p-12 text-center">
      <p class="text-gray-500 text-lg mb-4">条件に合う案件が見つかりませんでした</p>
      <%= link_to "フィルターをクリア", jobs_path, class: "text-blue-600 hover:underline" %>
    </div>
  <% end %>
<% end %>
